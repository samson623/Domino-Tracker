<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domino Game Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        /* Dark mode base styles */
        .dark {
            background-color: #1f2937;
            color: #f3f4f6;
        }
        
        .dark body {
            background-color: #1f2937;
        }
        
        .domino-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .domino-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .dark .domino-card {
            background: #374151;
            color: #f3f4f6;
        }
        
        .dark .bg-gray-50 {
            background-color: #4b5563;
        }
        
        .dark .bg-gray-100 {
            background-color: #1f2937;
        }
        
        .dark .bg-gray-200 {
            background-color: #4b5563;
        }
        
        .dark .text-gray-500 {
            color: #9ca3af;
        }
        
        .dark .text-gray-600 {
            color: #d1d5db;
        }
        
        .dark .text-gray-700 {
            color: #e5e7eb;
        }
        
        .dark .border {
            border-color: #4b5563;
        }
        
        .dark .border-gray-600 {
            border-color: #4b5563;
        }
        
        /* Dark mode input styles */
        .dark input,
        .dark select {
            background-color: #4b5563;
            color: #f3f4f6;
            border-color: #6b7280;
        }
        
        .dark input::placeholder {
            color: #9ca3af;
        }
        
        .dark option {
            background-color: #4b5563;
            color: #f3f4f6;
        }
        
        .score-btn {
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        .score-btn:hover:not(:disabled) {
            transform: scale(1.05);
            border-color: #3B82F6;
        }
        
        .score-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .petaroll-badge {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 4px;
        }
        
        .petarolled-badge {
            background: linear-gradient(45deg, #DC2626, #991B1B);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 4px;
        }
        
        .petaroll-alert {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .animate-pulse {
            animation: pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .game-item:hover .delete-game-btn {
            opacity: 1;
        }

        .delete-game-btn {
            opacity: 0;
            transition: opacity 0.2s;
        }

        .game-item:hover .edit-game-btn {
            opacity: 1;
        }

        .edit-game-btn {
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .game-mode-btn {
            transition: all 0.3s ease;
        }
        
        .game-mode-btn.active {
            background-color: #3B82F6;
            color: white;
            transform: scale(1.05);
        }

        .nav-btn.active, .mobile-nav-btn.active {
            background-color: rgba(255, 255, 255, 0.3);
            color: #3B82F6;
        }
        
        /* Custom score input styles */
        .custom-score-input {
            width: 100px;
            text-align: center;
            font-weight: bold;
        }
        
        /* Style for the add/subtract buttons */
        .custom-score-input::-webkit-inner-spin-button,
        .custom-score-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .custom-score-input {
            -moz-appearance: textfield;
        }

        .achievement-badge {
            background: linear-gradient(45deg, #34D399, #10B981);
            color: #000;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            display: inline-block;
            margin-right: 4px;
            margin-bottom: 4px;
        }

        #achievementToast {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: #10B981;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            z-index: 100;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-300">
    <!-- Navigation -->
    <nav class="domino-bg text-white p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i class="fas fa-dice-six text-2xl"></i>
                <h1 class="text-xl font-bold">Domino Tracker</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button onclick="showExportModal()" class="p-2 rounded-lg bg-green-600 hover:bg-green-700 transition" title="Export Data">
                    <i class="fas fa-download"></i>
                </button>
                <button onclick="showResetModal()" class="p-2 rounded-lg bg-red-600 hover:bg-red-700 transition" title="Reset All Data">
                    <i class="fas fa-trash-alt"></i>
                </button>
                <button id="themeToggle" class="p-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
                <div class="hidden md:flex space-x-2">
                    <button onclick="showSection('home')" data-section="home" class="nav-btn px-3 py-1 rounded-lg hover:bg-white hover:bg-opacity-20">
                        <i class="fas fa-home mr-1"></i>Home
                    </button>
                    <button onclick="showSection('live')" data-section="live" class="nav-btn px-3 py-1 rounded-lg hover:bg-white hover:bg-opacity-20">
                        <i class="fas fa-play mr-1"></i>Live Game
                    </button>
                    <button onclick="showSection('teams')" data-section="teams" class="nav-btn px-3 py-1 rounded-lg hover:bg-white hover:bg-opacity-20">
                        <i class="fas fa-users mr-1"></i>Teams
                    </button>
                    <button onclick="showSection('leaderboard')" data-section="leaderboard" class="nav-btn px-3 py-1 rounded-lg hover:bg-white hover:bg-opacity-20">
                        <i class="fas fa-trophy mr-1"></i>Leaderboard
                    </button>
                    <button onclick="showSection('history')" data-section="history" class="nav-btn px-3 py-1 rounded-lg hover:bg-white hover:bg-opacity-20">
                        <i class="fas fa-list mr-1"></i>History
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Navigation -->
    <div class="md:hidden bg-white dark:bg-gray-800 border-t dark:border-gray-700 fixed bottom-0 left-0 right-0 z-50">
        <div class="flex justify-around py-2">
            <button onclick="showSection('home')" data-section="home" class="mobile-nav-btn flex flex-col items-center p-2 text-gray-700 dark:text-gray-300">
                <i class="fas fa-home text-lg"></i>
                <span class="text-xs">Home</span>
            </button>
            <button onclick="showSection('live')" data-section="live" class="mobile-nav-btn flex flex-col items-center p-2 text-gray-700 dark:text-gray-300">
                <i class="fas fa-play text-lg"></i>
                <span class="text-xs">Live</span>
            </button>
            <button onclick="showSection('teams')" data-section="teams" class="mobile-nav-btn flex flex-col items-center p-2 text-gray-700 dark:text-gray-300">
                <i class="fas fa-users text-lg"></i>
                <span class="text-xs">Teams</span>
            </button>
            <button onclick="showSection('leaderboard')" data-section="leaderboard" class="mobile-nav-btn flex flex-col items-center p-2 text-gray-700 dark:text-gray-300">
                <i class="fas fa-trophy text-lg"></i>
                <span class="text-xs">Stats</span>
            </button>
            <button onclick="showSection('history')" data-section="history" class="mobile-nav-btn flex flex-col items-center p-2 text-gray-700 dark:text-gray-300">
                <i class="fas fa-list text-lg"></i>
                <span class="text-xs">History</span>
            </button>
        </div>
    </div>

    <div class="container mx-auto p-4 pb-20">
        <!-- Home Section -->
        <div id="homeSection" class="section">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Today's Team Stats -->
                <div class="domino-card p-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-calendar-day mr-2 text-blue-500"></i>
                        Today's Performance
                    </h3>
                    <div id="dailyTeamStats" class="space-y-3">
                        <!-- Dynamic content -->
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="domino-card p-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-bolt mr-2 text-yellow-500"></i>
                        Quick Actions
                    </h3>
                    <div class="space-y-3">
                        <button onclick="startNewGame()" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg font-medium">
                            <i class="fas fa-play mr-2"></i>Start New Game
                        </button>
                        <button onclick="showSection('teams')" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium">
                            <i class="fas fa-plus mr-2"></i>Create Team
                        </button>
                    </div>
                    <div class="mt-4 p-3 bg-yellow-50 dark:bg-yellow-900 rounded-lg">
                        <p class="text-sm font-medium text-yellow-800 dark:text-yellow-200">
                            <i class="fas fa-star mr-1"></i>PETAROLL: 75-0 or 150-&lt;75 = 2 wins!
                        </p>
                    </div>
                </div>

                <!-- Recent Games -->
                <div class="domino-card p-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-history mr-2 text-purple-500"></i>
                        Recent Games
                    </h3>
                    <div id="recentGames" class="space-y-2">
                        <!-- Dynamic content -->
                    </div>
                </div>

                <!-- Achievements -->
                <div class="domino-card p-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-award mr-2 text-green-500"></i>
                        Achievements
                    </h3>
                    <div id="achievementsList" class="space-y-1 text-sm">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </div>

            <!-- Daily Team Leaderboard Chart -->
            <div class="domino-card p-6">
                <h3 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fas fa-chart-bar mr-2 text-indigo-500"></i>
                    Daily Performance Chart
                </h3>
                <div style="height: 400px;">
                    <canvas id="dailyTeamChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Live Game Section -->
        <div id="liveSection" class="section hidden">
            <div class="max-w-4xl mx-auto">
                <!-- Game Mode Selection -->
                <div class="domino-card p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4 text-center">Select Game Mode</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="selectGameMode('team')" id="teamModeBtn" class="game-mode-btn p-6 border-2 border-gray-300 dark:border-gray-600 rounded-lg hover:border-blue-500 transition">
                            <i class="fas fa-users text-3xl mb-2"></i>
                            <h3 class="text-lg font-bold">Team vs Team</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">2 vs 2 players</p>
                        </button>
                        <button onclick="selectGameMode('single')" id="singleModeBtn" class="game-mode-btn p-6 border-2 border-gray-300 dark:border-gray-600 rounded-lg hover:border-blue-500 transition">
                            <i class="fas fa-user text-3xl mb-2"></i>
                            <h3 class="text-lg font-bold">One on One</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">1 vs 1 player</p>
                        </button>
                    </div>
                </div>

                <!-- Game Setup -->
                <div id="gameSetup" class="domino-card p-6 mb-6 hidden">
                    <h2 class="text-2xl font-bold mb-6 text-center">Setup New Game</h2>
                    
                    <!-- Team Mode Setup -->
                    <div id="teamModeSetup" class="hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium mb-2">Team 1</label>
                                <select id="team1Select" class="w-full p-3 border rounded-lg">
                                    <option value="">Select Team 1</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Team 2</label>
                                <select id="team2Select" class="w-full p-3 border rounded-lg">
                                    <option value="">Select Team 2</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Single Mode Setup -->
                    <div id="singleModeSetup" class="hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium mb-2">Player 1 Name</label>
                                <input type="text" id="player1Input" class="w-full p-3 border rounded-lg" placeholder="Enter player 1 name">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Player 2 Name</label>
                                <input type="text" id="player2Input" class="w-full p-3 border rounded-lg" placeholder="Enter player 2 name">
                            </div>
                        </div>
                    </div>

                    <!-- Best Of Selection -->
                    <div class="mt-4">
                        <label class="block text-sm font-medium mb-2">Match Length</label>
                        <select id="bestOfSelect" class="w-full p-3 border rounded-lg">
                            <option value="1">Single Game</option>
                            <option value="3">First to 3</option>
                            <option value="5">First to 5</option>
                        </select>
                    </div>
                    
                    <button onclick="startGame()" class="w-full mt-6 bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-lg font-bold text-lg">
                        <i class="fas fa-flag-checkered mr-2"></i>Start Game to 150!
                    </button>
                </div>

                <!-- Live Game Interface -->
                <div id="liveGame" class="hidden">
                    <!-- PETAROLL Alert -->
                    <div id="petarollAlert" class="hidden mb-4 p-4 bg-orange-100 dark:bg-orange-900 rounded-lg text-center">
                        <p class="text-lg font-bold text-orange-800 dark:text-orange-200">
                            <i class="fas fa-fire mr-2"></i>PETAROLL ALERT! Game will end at 75-0!<i class="fas fa-fire ml-2"></i>
                        </p>
                    </div>

                    <!-- Match Score -->
                    <div id="matchScore" class="text-center font-bold text-lg mb-4"></div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- Team 1 Score -->
                        <div class="domino-card p-6">
                            <div class="text-center">
                                <div id="team1Players" class="text-xl font-bold mb-4"></div>
                                <div class="text-6xl font-bold mb-4" id="team1Score">0</div>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-4">
                                    <div id="team1Progress" class="bg-blue-500 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                                <div class="grid grid-cols-4 gap-2 mb-4">
                                    <button onclick="addScore(1, 5)" class="score-btn bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-bold">+5</button>
                                    <button onclick="addScore(1, 10)" class="score-btn bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-bold">+10</button>
                                    <button onclick="addScore(1, 15)" class="score-btn bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-bold">+15</button>
                                    <button onclick="addScore(1, 20)" class="score-btn bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-bold">+20</button>
                                    <button onclick="addScore(1, 25)" class="score-btn bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-bold">+25</button>
                                    <button onclick="addScore(1, 30)" class="score-btn bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-bold">+30</button>
                                    <button onclick="addScore(1, 35)" class="score-btn bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-bold">+35</button>
                                    <button onclick="undoScore(1)" class="score-btn bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                </div>
                                <!-- Custom score input -->
                                <div class="flex justify-center items-center space-x-2 mt-2">
                                    <button onclick="subtractCustomScore(1)" class="bg-red-500 hover:bg-red-600 text-white py-2 px-3 rounded-lg font-bold">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <input type="number" id="customScore1" class="custom-score-input p-2 border rounded-lg" placeholder="Custom" min="-150" max="150">
                                    <button onclick="addCustomScore(1)" class="bg-green-500 hover:bg-green-600 text-white py-2 px-3 rounded-lg font-bold">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Team 2 Score -->
                        <div class="domino-card p-6">
                            <div class="text-center">
                                <div id="team2Players" class="text-xl font-bold mb-4"></div>
                                <div class="text-6xl font-bold mb-4" id="team2Score">0</div>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-4">
                                    <div id="team2Progress" class="bg-red-500 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                                <div class="grid grid-cols-4 gap-2 mb-4">
                                    <button onclick="addScore(2, 5)" class="score-btn bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold">+5</button>
                                    <button onclick="addScore(2, 10)" class="score-btn bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold">+10</button>
                                    <button onclick="addScore(2, 15)" class="score-btn bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold">+15</button>
                                    <button onclick="addScore(2, 20)" class="score-btn bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold">+20</button>
                                    <button onclick="addScore(2, 25)" class="score-btn bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold">+25</button>
                                    <button onclick="addScore(2, 30)" class="score-btn bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold">+30</button>
                                    <button onclick="addScore(2, 35)" class="score-btn bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold">+35</button>
                                    <button onclick="undoScore(2)" class="score-btn bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                </div>
                                <!-- Custom score input -->
                                <div class="flex justify-center items-center space-x-2 mt-2">
                                    <button onclick="subtractCustomScore(2)" class="bg-red-500 hover:bg-red-600 text-white py-2 px-3 rounded-lg font-bold">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <input type="number" id="customScore2" class="custom-score-input p-2 border rounded-lg" placeholder="Custom" min="-150" max="150">
                                    <button onclick="addCustomScore(2)" class="bg-green-500 hover:bg-green-600 text-white py-2 px-3 rounded-lg font-bold">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Game Controls -->
                    <div class="domino-card p-6 text-center">
                        <div class="flex justify-center space-x-4">
                            <button onclick="endGame()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg">
                                <i class="fas fa-stop mr-2"></i>End Game
                            </button>
                            <button onclick="resetGame()" class="bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-6 rounded-lg">
                                <i class="fas fa-sync mr-2"></i>Reset
                            </button>
                              <button id="micBtn" onclick="toggleMic()" class="bg-purple-500 hover:bg-purple-600 text-white py-2 px-6 rounded-lg">
                                  <i class="fas fa-microphone mr-2"></i>Voice
                              </button>
                        </div>
                            <div id="voiceOutput" class="mt-2 text-sm text-gray-600 dark:text-gray-300"></div>
                    </div>

                    <!-- Turn Timer -->
                    <div class="domino-card p-6 mt-6 text-center">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Turn Time Limit (seconds, max 60)</label>
                            <input type="number" id="turnTimeInput" class="w-24 p-2 border rounded-lg" min="5" max="60" value="60">
                        </div>
                        <div class="mb-4 text-3xl font-bold" id="turnTimerDisplay">--</div>
                        <div class="flex justify-center space-x-4">
                            <button onclick="startTurnTimer()" class="bg-green-500 hover:bg-green-600 text-white py-2 px-6 rounded-lg">
                                <i class="fas fa-play mr-2"></i>Start Timer
                            </button>
                            <button onclick="stopTurnTimer()" class="bg-red-500 hover:bg-red-600 text-white py-2 px-6 rounded-lg">
                                <i class="fas fa-stop mr-2"></i>Stop
                            </button>
                        </div>
                    </div>

                    <!-- Score History -->
                    <div class="domino-card p-6 mt-6">
                        <h3 class="text-lg font-bold mb-4">Score History</h3>
                        <div id="scoreHistory" class="max-h-40 overflow-y-auto space-y-2">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teams Section -->
        <div id="teamsSection" class="section hidden">
            <div class="mb-6">
                <button onclick="showCreateTeam()" class="bg-green-500 hover:bg-green-600 text-white py-2 px-6 rounded-lg font-medium">
                    <i class="fas fa-plus mr-2"></i>Create New Team
                </button>
            </div>

            <!-- Create Team Form -->
            <div id="createTeamForm" class="domino-card p-6 mb-6 hidden">
                <h3 class="text-xl font-bold mb-4">Create New Team</h3>
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Player 1 Name</label>
                        <input type="text" id="player1Name" class="w-full p-3 border rounded-lg" placeholder="Enter player 1 name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Player 2 Name</label>
                        <input type="text" id="player2Name" class="w-full p-3 border rounded-lg" placeholder="Enter player 2 name">
                    </div>
                </div>
                <div class="flex space-x-4 mt-6">
                    <button onclick="createTeam()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-6 rounded-lg font-medium">
                        <i class="fas fa-save mr-2"></i>Create Team
                    </button>
                    <button onclick="hideCreateTeam()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg font-medium">
                        <i class="fas fa-times mr-2"></i>Cancel
                    </button>
                </div>
            </div>

            <!-- Teams List -->
            <div id="teamsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Dynamic content -->
            </div>
        </div>

        <!-- History Section -->
        <div id="historySection" class="section hidden">
            <div class="domino-card p-6">
                <h3 class="text-xl font-bold mb-4 flex items-center justify-between">
                    <span>
                        <i class="fas fa-list mr-2 text-blue-500"></i>
                        Game History
                    </span>
                    <span class="text-sm font-normal text-gray-500 dark:text-gray-400">
                        Total Games: <span id="totalGamesCount">0</span>
                    </span>
                </h3>
                <div id="gameHistoryList" class="space-y-2">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>

        <!-- Leaderboard Section -->
        <div id="leaderboardSection" class="section hidden">
            <!-- Last Updated Time -->
            <div class="mb-4 text-right text-sm text-gray-500 dark:text-gray-400">
                <i class="fas fa-clock mr-1"></i>
                Last updated: <span id="lastUpdatedTime"></span>
            </div>
            
            <div class="mb-6">
                <div class="flex flex-wrap gap-2">
                    <button onclick="showLeaderboard('daily')" class="leaderboard-tab bg-blue-500 text-white py-2 px-4 rounded-lg font-medium">
                        <i class="fas fa-calendar-day mr-1"></i>Daily
                    </button>
                    <button onclick="showLeaderboard('weekly')" class="leaderboard-tab bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 py-2 px-4 rounded-lg font-medium">
                        <i class="fas fa-calendar-week mr-1"></i>Weekly
                    </button>
                    <button onclick="showLeaderboard('monthly')" class="leaderboard-tab bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 py-2 px-4 rounded-lg font-medium">
                        <i class="fas fa-calendar-alt mr-1"></i>Monthly
                    </button>
                    <button onclick="showLeaderboard('alltime')" class="leaderboard-tab bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 py-2 px-4 rounded-lg font-medium">
                        <i class="fas fa-infinity mr-1"></i>All Time
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Team Rankings -->
                <div class="domino-card p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center justify-between">
                        <span>
                            <i class="fas fa-users mr-2 text-blue-500"></i>
                            Team Rankings
                        </span>
                        <span id="teamPeriodInfo" class="text-xs text-gray-500 dark:text-gray-400"></span>
                    </h3>
                    <div id="teamRankings">
                        <!-- Dynamic content -->
                    </div>
                </div>

                <!-- Player Stats -->
                <div class="domino-card p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center justify-between">
                        <span>
                            <i class="fas fa-user mr-2 text-green-500"></i>
                            Top Players
                        </span>
                        <span id="playerPeriodInfo" class="text-xs text-gray-500 dark:text-gray-400"></span>
                    </h3>
                    <div id="playerStats">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </div>

            <!-- Performance Chart -->
            <div class="domino-card p-6 mt-6">
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-chart-line mr-2 text-purple-500"></i>
                    Performance Trends
                </h3>
                <div style="height: 400px;">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Win Modal -->
    <div id="winModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="domino-card p-8 m-4 max-w-md w-full text-center">
            <div class="text-6xl mb-4">🎉</div>
            <h2 class="text-2xl font-bold mb-4">Game Over!</h2>
            <div id="winMessage" class="text-lg mb-6"></div>
            <div class="flex space-x-4 justify-center">
                <button id="playAgainBtn" onclick="playAgain()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-6 rounded-lg font-medium">
                    <i class="fas fa-play mr-2"></i>Play Again
                </button>
                <button onclick="closeWinModal()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg font-medium">
                    <i class="fas fa-times mr-2"></i>Close
                </button>
            </div>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div id="resetModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="domino-card p-8 m-4 max-w-md w-full text-center">
            <div class="text-6xl mb-4 text-red-500">⚠️</div>
            <h2 class="text-2xl font-bold mb-4">Reset All Data?</h2>
            <p class="text-lg mb-6">This will permanently delete all teams, games, and statistics. This action cannot be undone!</p>
            <div class="flex space-x-4 justify-center">
                <button onclick="resetAllData()" class="bg-red-600 hover:bg-red-700 text-white py-2 px-6 rounded-lg font-medium">
                    <i class="fas fa-trash-alt mr-2"></i>Yes, Reset Everything
                </button>
                <button onclick="closeResetModal()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg font-medium">
                    <i class="fas fa-times mr-2"></i>Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="domino-card p-8 m-4 max-w-md w-full text-center">
            <div class="text-6xl mb-4">💾</div>
            <h2 class="text-2xl font-bold mb-4">Export Data</h2>
            <p class="text-lg mb-6">Download a backup of all your teams and game data.</p>
            <div class="flex space-x-4 justify-center">
                <button onclick="exportData()" class="bg-green-600 hover:bg-green-700 text-white py-2 px-6 rounded-lg font-medium">
                    <i class="fas fa-download mr-2"></i>Download Backup
                </button>
                <button onclick="closeExportModal()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-lg font-medium">
                    <i class="fas fa-times mr-2"></i>Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Game Modal -->
    <div id="editGameModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="domino-card p-6 m-4 max-w-md w-full">
            <h2 class="text-xl font-bold mb-4">Edit Game</h2>
            <div id="editGameForm" class="space-y-4"></div>
            <div class="flex justify-end space-x-2 mt-4">
                <button onclick="saveGameEdits()" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium">Save</button>
                <button onclick="closeEditGameModal()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-medium">Cancel</button>
            </div>
        </div>
    </div>

    <div id="achievementToast" class="hidden"></div>

    <script>
        // Global variables
        let currentGame = null;
        let currentGameMode = null;
        let teams = JSON.parse(localStorage.getItem('dominoTeams')) || [];
        let games = JSON.parse(localStorage.getItem('dominoGames')) || [];
        let currentSection = 'home';
        let chartInstances = {};
        let currentPeriod = 'daily';
        let bestOf = 1;
        let matchWins1 = 0;
        let matchWins2 = 0;
        let matchOver = false;
        let turnTimer = null;
        let remainingTime = 0;
        let editingGameId = null;
        let achievements = JSON.parse(localStorage.getItem('dominoAchievements')) || {};
        const achievementDefinitions = {
            tenWins: '🏅 Ten Wins',
            firstPetaroll: '🔥 First PETAROLL'
        };

        // Theme management
        function initTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                document.getElementById('themeIcon').className = 'fas fa-sun';
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('themeIcon').className = 'fas fa-moon';
            }
        }

        document.getElementById('themeToggle').addEventListener('click', () => {
            const isDark = document.documentElement.classList.contains('dark');
            if (isDark) {
                document.documentElement.classList.remove('dark');
                document.getElementById('themeIcon').className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.classList.add('dark');
                document.getElementById('themeIcon').className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            }
        });

        // Export functionality
        function showExportModal() {
            document.getElementById('exportModal').classList.remove('hidden');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.add('hidden');
        }

        function exportData() {
            const data = {
                teams: teams,
                games: games,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `domino-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            closeExportModal();
        }

        // Reset functionality
        function showResetModal() {
            document.getElementById('resetModal').classList.remove('hidden');
        }

        function closeResetModal() {
            document.getElementById('resetModal').classList.add('hidden');
        }

        function resetAllData() {
            // Clear all data from localStorage
            localStorage.removeItem('dominoTeams');
            localStorage.removeItem('dominoGames');
            localStorage.removeItem('dominoAchievements');
            
            // Reset global variables
            teams = [];
            games = [];
            achievements = {};
            currentGame = null;
            
            // Destroy all chart instances
            Object.values(chartInstances).forEach(chart => {
                if (chart) chart.destroy();
            });
            chartInstances = {};
            
            // Close modal
            closeResetModal();
            
            // Reload current section
            showSection(currentSection);
            
            // Show success message
            alert('All data has been reset successfully!');
        }

        // Navigation
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + 'Section').classList.remove('hidden');
            currentSection = section;
            
            // Update navigation states
            document.querySelectorAll('.nav-btn, .mobile-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll(`[data-section="${section}"]`).forEach(btn => {
                btn.classList.add('active');
            });
            
            if (section === 'home') loadHome();
            else if (section === 'teams') loadTeams();
            else if (section === 'leaderboard') loadLeaderboard();
            else if (section === 'live') loadLiveSection();
            else if (section === 'history') loadHistory();
        }

        // Function to refresh all data displays
        function refreshAllData() {
            // Reload home section data
            loadDailyTeamStats();
            loadRecentGames();
            loadDailyTeamChart();
            
            // If we're on the history page, reload it
            if (currentSection === 'history') {
                loadHistory();
            }
            
            // If we're on the teams page, reload it
            if (currentSection === 'teams') {
                loadTeams();
            }
            
            // If we're on the leaderboard page, reload it
            if (currentSection === 'leaderboard') {
                loadLeaderboard();
            }
        }

        // Home section
        function loadHome() {
            loadDailyTeamStats();
            loadRecentGames();
            loadDailyTeamChart();
            loadAchievements();
        }

        function loadDailyTeamStats() {
            const today = new Date().toDateString();
            const todayGames = games.filter(g => new Date(g.date).toDateString() === today);
            
            const teamStats = {};
            teams.forEach(team => {
                const teamName = `${team.player1} & ${team.player2}`;
                teamStats[team.id] = { name: teamName, wins: 0, losses: 0, petarolls: 0, gotPetarolled: 0 };
            });
            
            // Add single player stats
            const singlePlayerStats = {};
            
            todayGames.forEach(game => {
                if (game.gameMode === 'single') {
                    // Handle single player games
                    if (!singlePlayerStats[game.winner]) {
                        singlePlayerStats[game.winner] = { name: game.winner, wins: 0, losses: 0, petarolls: 0, gotPetarolled: 0 };
                    }
                    if (!singlePlayerStats[game.loser]) {
                        singlePlayerStats[game.loser] = { name: game.loser, wins: 0, losses: 0, petarolls: 0, gotPetarolled: 0 };
                    }
                    
                    singlePlayerStats[game.winner].wins += game.gameValue || 1;
                    if (game.isPetaroll) singlePlayerStats[game.winner].petarolls++;
                    
                    singlePlayerStats[game.loser].losses += game.gameValue || 1;
                    if (game.isPetaroll) singlePlayerStats[game.loser].gotPetarolled++;
                } else {
                    // Handle team games
                    if (teamStats[game.winner]) {
                        teamStats[game.winner].wins += game.gameValue || 1;
                        if (game.isPetaroll) teamStats[game.winner].petarolls++;
                    }
                    if (teamStats[game.loser]) {
                        teamStats[game.loser].losses += game.gameValue || 1;
                        if (game.isPetaroll) teamStats[game.loser].gotPetarolled++;
                    }
                }
            });
            
            const allStats = [...Object.values(teamStats), ...Object.values(singlePlayerStats)]
                .filter(stat => stat.wins > 0 || stat.losses > 0);
            
            const statsHtml = allStats
                .map(stat => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <span class="font-medium">${stat.name}</span>
                        <div class="flex items-center space-x-4">
                            <span class="text-green-600 font-bold">${stat.wins}W</span>
                            <span class="text-red-600 font-bold">${stat.losses}L</span>
                            ${stat.petarolls > 0 ? `<span class="petaroll-badge">${stat.petarolls} PETAROLL</span>` : ''}
                            ${stat.gotPetarolled > 0 ? `<span class="petarolled-badge">${stat.gotPetarolled} PETAROLLED</span>` : ''}
                        </div>
                    </div>
                `).join('');
            
            document.getElementById('dailyTeamStats').innerHTML = statsHtml || '<p class="text-gray-500 dark:text-gray-400">No games played today</p>';
        }

        function loadRecentGames() {
            const recentGames = games.slice(-5).reverse();
            const recentHtml = recentGames.map(game => {
                let winnerName, loserName;
                
                if (game.gameMode === 'single') {
                    winnerName = game.winner;
                    loserName = game.loser;
                } else {
                    const winnerTeam = teams.find(t => t.id === game.winner);
                    const loserTeam = teams.find(t => t.id === game.loser);
                    winnerName = winnerTeam ? `${winnerTeam.player1} & ${winnerTeam.player2}` : 'Unknown';
                    loserName = loserTeam ? `${loserTeam.player1} & ${loserTeam.player2}` : 'Unknown';
                }
                
                const gameTypeIcon = game.gameMode === 'single' ? '<i class="fas fa-user text-xs mr-1"></i>' : '<i class="fas fa-users text-xs mr-1"></i>';
                
                if (game.isPetaroll) {
                    return `
                        <div class="text-sm p-2 bg-gray-50 dark:bg-gray-700 rounded game-item relative">
                            <div>
                                ${gameTypeIcon}<strong>${winnerName}</strong> PETAROLLED <strong>${loserName}</strong>
                                <span class="petaroll-badge">PETAROLL</span>
                            </div>
                            <div class="text-gray-500 dark:text-gray-400 text-xs">
                                ${game.winnerScore}-${game.loserScore} • ${new Date(game.date).toLocaleString()}
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="text-sm p-2 bg-gray-50 dark:bg-gray-700 rounded game-item relative">
                            <div>
                                ${gameTypeIcon}<strong>${winnerName}</strong> beat <strong>${loserName}</strong>
                            </div>
                            <div class="text-gray-500 dark:text-gray-400 text-xs">
                                ${game.winnerScore}-${game.loserScore} • ${new Date(game.date).toLocaleString()}
                            </div>
                        </div>
                    `;
                }
            }).join('');
            
            document.getElementById('recentGames').innerHTML = recentHtml || '<p class="text-gray-500 dark:text-gray-400 text-sm">No recent games</p>';
        }

        function loadAchievements() {
            const listEl = document.getElementById('achievementsList');
            const unlocked = Object.keys(achievements).filter(key => achievements[key]);
            const html = unlocked.map(key => {
                const value = achievements[key];
                const winner = value && typeof value === 'object' ? ` - ${value.winner}` : '';
                return `<span class="achievement-badge">${achievementDefinitions[key]}${winner}</span>`;
            }).join('');
            listEl.innerHTML = html || '<p class="text-gray-500 dark:text-gray-400">No achievements yet</p>';
        }

        function getWinnerName(game) {
            if (!game) return 'Unknown';
            if (game.gameMode === 'single') {
                return game.winner;
            } else {
                const team = teams.find(t => t.id === game.winner);
                return team ? `${team.player1} & ${team.player2}` : 'Unknown';
            }
        }

        function checkAchievements() {
            const totalWins = games.reduce((sum, g) => sum + (g.gameValue || 1), 0);
            let updated = false;
            const lastGame = games[games.length - 1];
            if (totalWins >= 10 && !achievements.tenWins) {
                const winnerName = getWinnerName(lastGame);
                achievements.tenWins = { winner: winnerName };
                showAchievement('Achievement Unlocked: ' + achievementDefinitions.tenWins + ' - ' + winnerName);
                updated = true;
            }
            const firstPetarollGame = games.find(g => g.isPetaroll);
            if (firstPetarollGame && !achievements.firstPetaroll) {
                const winnerName = getWinnerName(firstPetarollGame);
                achievements.firstPetaroll = { winner: winnerName };
                showAchievement('Achievement Unlocked: ' + achievementDefinitions.firstPetaroll + ' - ' + winnerName);
                updated = true;
            }
            if (updated) {
                localStorage.setItem('dominoAchievements', JSON.stringify(achievements));
                loadAchievements();
            }
        }

        function showAchievement(message) {
            const toast = document.getElementById('achievementToast');
            toast.textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        function loadHistory() {
            // Reload games from localStorage to ensure we have the latest data
            games = JSON.parse(localStorage.getItem('dominoGames')) || [];
            
            document.getElementById('totalGamesCount').textContent = games.length;
            
            const sortedGames = [...games].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const historyHtml = sortedGames.map(game => {
                let winnerName, loserName;
                
                if (game.gameMode === 'single') {
                    winnerName = game.winner;
                    loserName = game.loser;
                } else {
                    const winnerTeam = teams.find(t => t.id === game.winner);
                    const loserTeam = teams.find(t => t.id === game.loser);
                    winnerName = winnerTeam ? `${winnerTeam.player1} & ${winnerTeam.player2}` : 'Unknown';
                    loserName = loserTeam ? `${loserTeam.player1} & ${loserTeam.player2}` : 'Unknown';
                }
                
                // Calculate game duration
                const duration = game.duration ? formatDuration(game.duration) : 'N/A';
                const gameTypeIcon = game.gameMode === 'single' ? '<i class="fas fa-user text-sm mr-1"></i>' : '<i class="fas fa-users text-sm mr-1"></i>';
                
                return `
                    <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg game-item relative">
                        <button onclick="showEditGameModal('${game.id}')" class="edit-game-btn absolute top-2 right-10 text-blue-500 hover:text-blue-700 p-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteGame('${game.id}')" class="delete-game-btn absolute top-2 right-2 text-red-500 hover:text-red-700 p-2">
                            <i class="fas fa-trash"></i>
                        </button>
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="font-medium">
                                    ${gameTypeIcon}${winnerName} ${game.isPetaroll ? 'PETAROLLED' : 'beat'} ${loserName}
                                    ${game.isPetaroll ? '<span class="petaroll-badge">PETAROLL</span>' : ''}
                                </div>
                                <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                                    Score: ${game.winnerScore} - ${game.loserScore} | Duration: ${duration}
                                </div>
                                <div class="text-xs text-gray-400 dark:text-gray-500 mt-1">
                                    ${new Date(game.date).toLocaleString()}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('gameHistoryList').innerHTML = historyHtml || '<p class="text-gray-500 dark:text-gray-400">No games played yet</p>';
        }

        function formatDuration(milliseconds) {
            const seconds = Math.floor(milliseconds / 1000);
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function deleteGame(gameId) {
            if (confirm('Are you sure you want to delete this game? This will affect all statistics.')) {
                games = games.filter(g => g.id != gameId);
                localStorage.setItem('dominoGames', JSON.stringify(games));

                // Reload all sections that might be affected
                refreshAllData();

                alert('Game deleted successfully!');
            }
        }

        function showEditGameModal(gameId) {
            const game = games.find(g => g.id == gameId);
            if (!game) return;
            editingGameId = gameId;

            let formHtml = '';
            if (game.gameMode === 'team') {
                const options = teams.map(t => `<option value="${t.id}">${t.player1} & ${t.player2}</option>`).join('');
                formHtml += `
                    <label class="block text-sm font-medium">Winner</label>
                    <select id="editWinner" class="w-full p-2 border rounded-lg mb-2">${options}</select>
                    <label class="block text-sm font-medium">Loser</label>
                    <select id="editLoser" class="w-full p-2 border rounded-lg mb-2">${options}</select>
                `;
            } else {
                formHtml += `
                    <label class="block text-sm font-medium">Winner</label>
                    <input id="editWinner" type="text" class="w-full p-2 border rounded-lg mb-2" />
                    <label class="block text-sm font-medium">Loser</label>
                    <input id="editLoser" type="text" class="w-full p-2 border rounded-lg mb-2" />
                `;
            }

            formHtml += `
                <label class="block text-sm font-medium">Winner Score</label>
                <input id="editWinnerScore" type="number" class="w-full p-2 border rounded-lg mb-2" />
                <label class="block text-sm font-medium">Loser Score</label>
                <input id="editLoserScore" type="number" class="w-full p-2 border rounded-lg mb-2" />
                <label class="inline-flex items-center mt-2"><input type="checkbox" id="editIsPetaroll" class="mr-2">PETAROLL</label>
            `;

            document.getElementById('editGameForm').innerHTML = formHtml;

            document.getElementById('editWinner').value = game.winner;
            document.getElementById('editLoser').value = game.loser;
            document.getElementById('editWinnerScore').value = game.winnerScore;
            document.getElementById('editLoserScore').value = game.loserScore;
            document.getElementById('editIsPetaroll').checked = !!game.isPetaroll;

            document.getElementById('editGameModal').classList.remove('hidden');
        }

        function closeEditGameModal() {
            document.getElementById('editGameModal').classList.add('hidden');
            editingGameId = null;
        }

        function saveGameEdits() {
            if (editingGameId === null) return;
            const game = games.find(g => g.id == editingGameId);
            if (!game) return;

            const winnerVal = document.getElementById('editWinner').value;
            const loserVal = document.getElementById('editLoser').value;
            game.winner = game.gameMode === 'team' ? parseInt(winnerVal) : winnerVal;
            game.loser = game.gameMode === 'team' ? parseInt(loserVal) : loserVal;
            game.winnerScore = parseInt(document.getElementById('editWinnerScore').value) || 0;
            game.loserScore = parseInt(document.getElementById('editLoserScore').value) || 0;
            game.isPetaroll = document.getElementById('editIsPetaroll').checked;
            game.gameValue = game.isPetaroll ? 2 : 1;

            localStorage.setItem('dominoGames', JSON.stringify(games));
            closeEditGameModal();

            refreshAllData();
        }

        function loadDailyTeamChart() {
            const today = new Date().toDateString();
            const todayGames = games.filter(g => new Date(g.date).toDateString() === today);
            
            const teamData = {};
            teams.forEach(team => {
                const teamName = `${team.player1} & ${team.player2}`;
                teamData[teamName] = { wins: 0, losses: 0 };
            });
            
            // Add single player data
            const singlePlayerData = {};
            
            todayGames.forEach(game => {
                if (game.gameMode === 'single') {
                    if (!singlePlayerData[game.winner]) {
                        singlePlayerData[game.winner] = { wins: 0, losses: 0 };
                    }
                    if (!singlePlayerData[game.loser]) {
                        singlePlayerData[game.loser] = { wins: 0, losses: 0 };
                    }
                    singlePlayerData[game.winner].wins += game.gameValue || 1;
                    singlePlayerData[game.loser].losses += game.gameValue || 1;
                } else {
                    const winnerTeam = teams.find(t => t.id === game.winner);
                    const loserTeam = teams.find(t => t.id === game.loser);
                    if (winnerTeam) {
                        const winnerName = `${winnerTeam.player1} & ${winnerTeam.player2}`;
                        teamData[winnerName].wins += game.gameValue || 1;
                    }
                    if (loserTeam) {
                        const loserName = `${loserTeam.player1} & ${loserTeam.player2}`;
                        teamData[loserName].losses += game.gameValue || 1;
                    }
                }
            });
            
            const allData = {...teamData, ...singlePlayerData};
            const ctx = document.getElementById('dailyTeamChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (chartInstances.dailyTeamChart) {
                chartInstances.dailyTeamChart.destroy();
            }
            
            chartInstances.dailyTeamChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(allData),
                    datasets: [
                        {
                            label: 'Wins',
                            data: Object.values(allData).map(d => d.wins),
                            backgroundColor: 'rgba(34, 197, 94, 0.8)',
                            borderColor: 'rgba(34, 197, 94, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Losses',
                            data: Object.values(allData).map(d => d.losses),
                            backgroundColor: 'rgba(239, 68, 68, 0.8)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Live game section
        function loadLiveSection() {
            // Reset game setup
            document.getElementById('gameSetup').classList.add('hidden');
            document.getElementById('liveGame').classList.add('hidden');
            document.getElementById('teamModeBtn').classList.remove('active');
            document.getElementById('singleModeBtn').classList.remove('active');
            currentGameMode = null;
        }

        function selectGameMode(mode) {
            currentGameMode = mode;
            
            // Update button states
            document.getElementById('teamModeBtn').classList.remove('active');
            document.getElementById('singleModeBtn').classList.remove('active');
            
            if (mode === 'team') {
                document.getElementById('teamModeBtn').classList.add('active');
                document.getElementById('teamModeSetup').classList.remove('hidden');
                document.getElementById('singleModeSetup').classList.add('hidden');
                populateTeamSelects();
            } else {
                document.getElementById('singleModeBtn').classList.add('active');
                document.getElementById('teamModeSetup').classList.add('hidden');
                document.getElementById('singleModeSetup').classList.remove('hidden');
            }
            
            document.getElementById('gameSetup').classList.remove('hidden');
        }

        function populateTeamSelects() {
            const team1Select = document.getElementById('team1Select');
            const team2Select = document.getElementById('team2Select');
            
            team1Select.innerHTML = '<option value="">Select Team 1</option>';
            team2Select.innerHTML = '<option value="">Select Team 2</option>';
            
            teams.forEach(team => {
                const teamDisplay = `${team.player1} & ${team.player2}`;
                team1Select.innerHTML += `<option value="${team.id}">${teamDisplay}</option>`;
                team2Select.innerHTML += `<option value="${team.id}">${teamDisplay}</option>`;
            });
        }

        function startNewGame() {
            showSection('live');
        }

        function startGame() {
            bestOf = parseInt(document.getElementById('bestOfSelect').value);
            matchWins1 = 0;
            matchWins2 = 0;
            matchOver = false;
            stopTurnTimer();

            if (currentGameMode === 'team') {
                const team1Id = document.getElementById('team1Select').value;
                const team2Id = document.getElementById('team2Select').value;
                
                if (!team1Id || !team2Id) {
                    alert('Please select both teams');
                    return;
                }
                
                if (team1Id === team2Id) {
                    alert('Please select different teams');
                    return;
                }
                
                const team1 = teams.find(t => t.id === team1Id);
                const team2 = teams.find(t => t.id === team2Id);
                
                currentGame = {
                    gameMode: 'team',
                    team1: team1,
                    team2: team2,
                    score1: 0,
                    score2: 0,
                    history: [],
                    startTime: new Date(),
                    ended: false
                };
                
                document.getElementById('team1Players').textContent = `${team1.player1} & ${team1.player2}`;
                document.getElementById('team2Players').textContent = `${team2.player1} & ${team2.player2}`;
            } else {
                const player1Name = document.getElementById('player1Input').value.trim();
                const player2Name = document.getElementById('player2Input').value.trim();
                
                if (!player1Name || !player2Name) {
                    alert('Please enter both player names');
                    return;
                }
                
                currentGame = {
                    gameMode: 'single',
                    player1: player1Name,
                    player2: player2Name,
                    score1: 0,
                    score2: 0,
                    history: [],
                    startTime: new Date(),
                    ended: false
                };
                
                document.getElementById('team1Players').textContent = player1Name;
                document.getElementById('team2Players').textContent = player2Name;
            }
            
            document.getElementById('gameSetup').classList.add('hidden');
            document.getElementById('liveGame').classList.remove('hidden');
            
            // Clear custom score inputs
            document.getElementById('customScore1').value = '';
            document.getElementById('customScore2').value = '';
            
            enableScoreButtons();
            updateGameDisplay();
            updateMatchScoreDisplay();
        }

        function updateGameDisplay() {
            if (!currentGame) return;
            
            document.getElementById('team1Score').textContent = currentGame.score1;
            document.getElementById('team2Score').textContent = currentGame.score2;
            
            // Update progress bars
            const progress1 = Math.min((currentGame.score1 / 150) * 100, 100);
            const progress2 = Math.min((currentGame.score2 / 150) * 100, 100);
            document.getElementById('team1Progress').style.width = progress1 + '%';
            document.getElementById('team2Progress').style.width = progress2 + '%';
            
            // Check for potential PETAROLL and show warning
            const petarollAlert = document.getElementById('petarollAlert');
            if ((currentGame.score1 >= 50 && currentGame.score2 === 0) || 
                (currentGame.score2 >= 50 && currentGame.score1 === 0)) {
                petarollAlert.classList.remove('hidden');
                petarollAlert.classList.add('petaroll-alert');
                
                // Add visual indicator that PETAROLL is active
                if (currentGame.score1 >= 50 && currentGame.score2 === 0) {
                    document.getElementById('team1Score').classList.add('text-orange-600');
                } else {
                    document.getElementById('team2Score').classList.add('text-orange-600');
                }
            } else {
                petarollAlert.classList.add('hidden');
                document.getElementById('team1Score').classList.remove('text-orange-600');
                document.getElementById('team2Score').classList.remove('text-orange-600');
            }
            
            // Update score history with better formatting
            const historyHtml = currentGame.history.map((entry, index) => {
                const pointsDisplay = entry.points > 0 ? `+${entry.points}` : `${entry.points}`;
                const actionText = entry.points > 0 ? 'scored' : 'lost';
                const colorClass = entry.points > 0 ? 'text-green-600' : 'text-red-600';
                
                return `
                    <div class="text-sm p-2 bg-gray-50 dark:bg-gray-700 rounded flex justify-between">
                        <span>${entry.team} <span class="${colorClass} font-bold">${pointsDisplay}</span></span>
                        <span class="text-gray-500 dark:text-gray-400">${entry.team1Score} - ${entry.team2Score}</span>
                    </div>
                `;
            }).join('');
            document.getElementById('scoreHistory').innerHTML = historyHtml;
        }

        function updateMatchScoreDisplay() {
            const display = document.getElementById('matchScore');
            if (display) {
                display.textContent = `Match Score: ${matchWins1} - ${matchWins2}`;
            }
        }

        // Add custom score function
        function addCustomScore(team) {
            const customScoreInput = document.getElementById(`customScore${team}`);
            const customScore = parseInt(customScoreInput.value);
            
            if (!customScore || customScore === 0) {
                alert('Please enter a valid score');
                return;
            }
            
            // Check if it's a negative score (subtraction)
            if (customScore < 0) {
                // Make sure we don't go below 0
                const currentScore = team === 1 ? currentGame.score1 : currentGame.score2;
                if (currentScore + customScore < 0) {
                    alert('Score cannot go below 0');
                    return;
                }
            }
            
            addScore(team, customScore);
            customScoreInput.value = ''; // Clear the input after adding
        }

        // Add a new function specifically for subtraction
        function subtractCustomScore(team) {
            const customScoreInput = document.getElementById(`customScore${team}`);
            let customScore = parseInt(customScoreInput.value);
            
            // If no value entered, default to 5
            if (!customScore || customScore === 0) {
                customScore = 5;
            }
            
            // Make sure we use the absolute value for subtraction
            customScore = Math.abs(customScore);
            
            // Check if we can subtract this amount
            const currentScore = team === 1 ? currentGame.score1 : currentGame.score2;
            if (currentScore - customScore < 0) {
                alert('Score cannot go below 0');
                return;
            }
            
            // Subtract by adding a negative value
            addScore(team, -customScore);
            customScoreInput.value = ''; // Clear the input after subtracting
        }

        function addScore(team, points) {
            if (!currentGame) return;
            
            // Check if game has already ended
            if (currentGame.ended) {
                alert("This game has ended. Please start a new game.");
                return;
            }
            
            const previousScore1 = currentGame.score1;
            const previousScore2 = currentGame.score2;
            
            // Update scores and ensure they don't go below 0
            if (team === 1) {
                currentGame.score1 = Math.max(0, currentGame.score1 + points);
            } else {
                currentGame.score2 = Math.max(0, currentGame.score2 + points);
            }
            
            let teamName;
            if (currentGame.gameMode === 'team') {
                teamName = team === 1 
                    ? `${currentGame.team1.player1} & ${currentGame.team1.player2}`
                    : `${currentGame.team2.player1} & ${currentGame.team2.player2}`;
            } else {
                teamName = team === 1 ? currentGame.player1 : currentGame.player2;
            }
            
            // Record the action in history (whether add or subtract)
            const action = points > 0 ? 'scored' : 'lost';
            currentGame.history.push({
                team: teamName,
                points: points,
                action: action,
                team1Score: currentGame.score1,
                team2Score: currentGame.score2,
                time: new Date()
            });
            
            updateGameDisplay();
            
            // Check for PETAROLL conditions
            const score1 = currentGame.score1;
            const score2 = currentGame.score2;
            
            // Check if either team has reached 75 while the other has 0 (PETAROLL)
            if ((score1 >= 75 && score2 === 0) || (score2 >= 75 && score1 === 0)) {
                // It's a PETAROLL - end the game immediately
                setTimeout(() => {
                    declarePetaroll();
                }, 500);
                return;
            }
            
            // Check for regular win (150 points)
            if (score1 >= 150 || score2 >= 150) {
                // Check if it's a PETAROLL (winner has 150+ and loser has less than 75)
                if ((score1 >= 150 && score2 < 75) || (score2 >= 150 && score1 < 75)) {
                    // It's a PETAROLL
                    setTimeout(() => {
                        declarePetaroll();
                    }, 500);
                } else {
                    // Regular win
                    setTimeout(declareWinner, 500);
                }
            }
        }

        function undoScore(team) {
            if (!currentGame || currentGame.history.length === 0) return;
            
            let teamName;
            if (currentGame.gameMode === 'team') {
                teamName = team === 1 
                    ? `${currentGame.team1.player1} & ${currentGame.team1.player2}`
                    : `${currentGame.team2.player1} & ${currentGame.team2.player2}`;
            } else {
                teamName = team === 1 ? currentGame.player1 : currentGame.player2;
            }
            
            // Find the last entry for this specific team
            let lastTeamEntryIndex = -1;
            for (let i = currentGame.history.length - 1; i >= 0; i--) {
                if (currentGame.history[i].team === teamName) {
                    lastTeamEntryIndex = i;
                    break;
                }
            }
            
            if (lastTeamEntryIndex === -1) return; // No entry found for this team
            
            const entryToRemove = currentGame.history[lastTeamEntryIndex];
            
            // Remove the points from the score
            if (team === 1) {
                currentGame.score1 -= entryToRemove.points;
            } else {
                currentGame.score2 -= entryToRemove.points;
            }
            
            // Remove the entry from history
            currentGame.history.splice(lastTeamEntryIndex, 1);
            
            // Recalculate all scores after this point to maintain consistency
            recalculateScoresFromHistory();
            
            updateGameDisplay();
        }

        function recalculateScoresFromHistory() {
            // Reset scores
            currentGame.score1 = 0;
            currentGame.score2 = 0;
            
            // Recalculate based on remaining history
            currentGame.history.forEach(entry => {
                let isTeam1;
                if (currentGame.gameMode === 'team') {
                    isTeam1 = entry.team === `${currentGame.team1.player1} & ${currentGame.team1.player2}`;
                } else {
                    isTeam1 = entry.team === currentGame.player1;
                }
                
                if (isTeam1) {
                    currentGame.score1 += entry.points;
                } else {
                    currentGame.score2 += entry.points;
                }
                
                // Update the history entry with correct cumulative scores
                entry.team1Score = currentGame.score1;
                entry.team2Score = currentGame.score2;
            });
        }

        // New function specifically for PETAROLL
        function declarePetaroll() {
            if (!currentGame) return;

            playPetarollEffects();
            
            currentGame.ended = true;
            
            let winner, loser, winnerScore, loserScore;
            
            if (currentGame.gameMode === 'team') {
                winner = currentGame.score1 > currentGame.score2 ? currentGame.team1 : currentGame.team2;
                loser = currentGame.score1 > currentGame.score2 ? currentGame.team2 : currentGame.team1;
                winnerScore = currentGame.score1 > currentGame.score2 ? currentGame.score1 : currentGame.score2;
                loserScore = currentGame.score1 > currentGame.score2 ? currentGame.score2 : currentGame.score1;
                
                // Count how many times the loser has been PETAROLLED before
                const previousPetarolls = games.filter(g => g.loser === loser.id && g.isPetaroll).length;
                const totalPetarolls = previousPetarolls + 1;
                
                // Save game with PETAROLL flag
                const gameRecord = {
                    id: Date.now(),
                    gameMode: 'team',
                    winner: winner.id,
                    loser: loser.id,
                    winnerScore: winnerScore,
                    loserScore: loserScore,
                    date: new Date().toISOString(),
                    duration: new Date().getTime() - currentGame.startTime.getTime(),
                    isPetaroll: true,
                    gameValue: 2
                };
                
                games.push(gameRecord);
                localStorage.setItem('dominoGames', JSON.stringify(games));
                checkAchievements();

                winnerName = `${winner.player1} & ${winner.player2}`;
                loserName = `${loser.player1} & ${loser.player2}`;

                let messageHtml = `
                    <div class="text-3xl font-bold text-orange-600 mb-4">🔥 PETAROLL! 🔥</div>
                    <div class="text-lg font-bold mb-2">PETAROLL PETAROLL!</div>
                    <div class="text-xl mb-2">
                        <strong>${winnerName}</strong>
                    </div>
                    <div class="text-lg mb-2">PETAROLLED</div>
                    <div class="text-xl mb-2">
                        <strong>${loserName}</strong>
                    </div>
                    <div class="text-lg mb-2">Final Score: ${winnerScore} - ${loserScore}</div>
                    <div class="mt-4 p-3 bg-red-100 dark:bg-red-900 rounded-lg">
                        <div class="text-red-800 dark:text-red-200">
                            ${loserName} has been PETAROLLED <strong>${totalPetarolls}</strong> time${totalPetarolls > 1 ? 's' : ''}!
                        </div>
                    </div>
                    <div class="mt-4">
                        <span class="petaroll-badge text-xl">This counts as 2 WINS!</span>
                    </div>
                `;
                document.getElementById('winMessage').innerHTML = messageHtml;
            } else {
                // Single player mode
                winnerName = currentGame.score1 > currentGame.score2 ? currentGame.player1 : currentGame.player2;
                loserName = currentGame.score1 > currentGame.score2 ? currentGame.player2 : currentGame.player1;
                winnerScore = currentGame.score1 > currentGame.score2 ? currentGame.score1 : currentGame.score2;
                loserScore = currentGame.score1 > currentGame.score2 ? currentGame.score2 : currentGame.score1;
                
                // Count how many times the loser has been PETAROLLED before
                const previousPetarolls = games.filter(g => g.loser === loserName && g.isPetaroll && g.gameMode === 'single').length;
                const totalPetarolls = previousPetarolls + 1;
                
                // Save game with PETAROLL flag
                const gameRecord = {
                    id: Date.now(),
                    gameMode: 'single',
                    winner: winnerName,
                    loser: loserName,
                    winnerScore: winnerScore,
                    loserScore: loserScore,
                    date: new Date().toISOString(),
                    duration: new Date().getTime() - currentGame.startTime.getTime(),
                    isPetaroll: true,
                    gameValue: 2
                };
                
                games.push(gameRecord);
                localStorage.setItem('dominoGames', JSON.stringify(games));
                checkAchievements();

                let messageHtml = `
                    <div class="text-3xl font-bold text-orange-600 mb-4">🔥 PETAROLL! 🔥</div>
                    <div class="text-lg font-bold mb-2">PETAROLL PETAROLL!</div>
                    <div class="text-xl mb-2">
                        <strong>${winnerName}</strong>
                    </div>
                    <div class="text-lg mb-2">PETAROLLED</div>
                    <div class="text-xl mb-2">
                        <strong>${loserName}</strong>
                    </div>
                    <div class="text-lg mb-2">Final Score: ${winnerScore} - ${loserScore}</div>
                    <div class="mt-4 p-3 bg-red-100 dark:bg-red-900 rounded-lg">
                        <div class="text-red-800 dark:text-red-200">
                            ${loserName} has been PETAROLLED <strong>${totalPetarolls}</strong> time${totalPetarolls > 1 ? 's' : ''}!
                        </div>
                    </div>
                    <div class="mt-4">
                        <span class="petaroll-badge text-xl">This counts as 2 WINS!</span>
                    </div>
                `;
                document.getElementById('winMessage').innerHTML = messageHtml;
            }

            // Update match series
            if (currentGame.score1 > currentGame.score2) {
                matchWins1 += 2; // Petaroll counts as two wins
            } else {
                matchWins2 += 2;
            }
            updateMatchScoreDisplay();
            const requiredWins = bestOf;
            let seriesInfo = `<div class="mt-2">Series Score: ${matchWins1} - ${matchWins2}</div>`;
            if (matchWins1 >= requiredWins || matchWins2 >= requiredWins) {
                matchOver = true;
                seriesInfo += `<div class="mt-2 font-bold">${winnerName} wins first to ${bestOf}!</div>`;
            }
            document.getElementById('playAgainBtn').classList.remove('hidden');
            document.getElementById('winMessage').innerHTML += seriesInfo;

            // Refresh all data displays
            refreshAllData();
            
            document.getElementById('winModal').classList.remove('hidden');
            
            // Disable score buttons to prevent further scoring
            disableScoreButtons();
        }

        // Function to disable all score buttons
        function disableScoreButtons() {
            const buttons = document.querySelectorAll('.score-btn');
            buttons.forEach(button => {
                button.disabled = true;
                button.classList.add('opacity-50', 'cursor-not-allowed');
            });
        }

        // Function to enable all score buttons
        function enableScoreButtons() {
            const buttons = document.querySelectorAll('.score-btn');
            buttons.forEach(button => {
                button.disabled = false;
                button.classList.remove('opacity-50', 'cursor-not-allowed');
            });
        }

        function declareWinner() {
            if (!currentGame) return;

            playEndGameSound();

            currentGame.ended = true;

            let gameRecord;
            let winnerName;
            let loserName;
            let winnerScore;
            let loserScore;
            
            if (currentGame.gameMode === 'team') {
                const winner = currentGame.score1 >= 150 ? currentGame.team1 : currentGame.team2;
                const loser = currentGame.score1 >= 150 ? currentGame.team2 : currentGame.team1;
                winnerScore = currentGame.score1 >= 150 ? currentGame.score1 : currentGame.score2;
                loserScore = currentGame.score1 >= 150 ? currentGame.score2 : currentGame.score1;
                
                gameRecord = {
                    id: Date.now(),
                    gameMode: 'team',
                    winner: winner.id,
                    loser: loser.id,
                    winnerScore: winnerScore,
                    loserScore: loserScore,
                    date: new Date().toISOString(),
                    duration: new Date().getTime() - currentGame.startTime.getTime(),
                    isPetaroll: false,
                    gameValue: 1
                };
                
                winnerName = `${winner.player1} & ${winner.player2}`;
                loserName = `${loser.player1} & ${loser.player2}`;
            } else {
                // Single player mode
                winnerName = currentGame.score1 >= 150 ? currentGame.player1 : currentGame.player2;
                loserName = currentGame.score1 >= 150 ? currentGame.player2 : currentGame.player1;
                winnerScore = currentGame.score1 >= 150 ? currentGame.score1 : currentGame.score2;
                loserScore = currentGame.score1 >= 150 ? currentGame.score2 : currentGame.score1;
                
                gameRecord = {
                    id: Date.now(),
                    gameMode: 'single',
                    winner: winnerName,
                    loser: loserName,
                    winnerScore: winnerScore,
                    loserScore: loserScore,
                    date: new Date().toISOString(),
                    duration: new Date().getTime() - currentGame.startTime.getTime(),
                    isPetaroll: false,
                    gameValue: 1
                };
            }
            
            games.push(gameRecord);
            localStorage.setItem('dominoGames', JSON.stringify(games));
            checkAchievements();

            // Update match series
            if (currentGame.score1 > currentGame.score2) {
                matchWins1++;
            } else {
                matchWins2++;
            }
            updateMatchScoreDisplay();
            const requiredWins = bestOf;
            let seriesInfo = `<div class="mt-2">Series Score: ${matchWins1} - ${matchWins2}</div>`;
            if (matchWins1 >= requiredWins || matchWins2 >= requiredWins) {
                matchOver = true;
                seriesInfo += `<div class="mt-2 font-bold">${winnerName} wins first to ${bestOf}!</div>`;
            }
            document.getElementById('playAgainBtn').classList.remove('hidden');
            document.getElementById('winMessage').innerHTML = `
                <strong>${winnerName}</strong> wins!<br>
                Final Score: ${winnerScore} - ${loserScore}
            ` + seriesInfo;
            
            // Refresh all data displays
            refreshAllData();
            
            document.getElementById('winModal').classList.remove('hidden');
            
            // Disable score buttons
            disableScoreButtons();
        }

        function playAgain() {
            if (matchOver) {
                matchWins1 = 0;
                matchWins2 = 0;
                matchOver = false;
                resetGame();
                updateMatchScoreDisplay();
                closeWinModal();
            } else {
                resetGame();
                closeWinModal();
            }
        }

        function closeWinModal() {
            document.getElementById('winModal').classList.add('hidden');
        }

        function resetGame() {
            if (currentGame) {
                currentGame.score1 = 0;
                currentGame.score2 = 0;
                currentGame.history = [];
                currentGame.ended = false;
                document.getElementById('petarollAlert').classList.add('hidden');

                stopTurnTimer();

                // Clear custom score inputs
                document.getElementById('customScore1').value = '';
                document.getElementById('customScore2').value = '';
                
                updateGameDisplay();
                enableScoreButtons();
            }
        }

        function endGame() {
            currentGame = null;
            currentGameMode = null;
            matchWins1 = 0;
            matchWins2 = 0;
            matchOver = false;
            stopTurnTimer();
            updateMatchScoreDisplay();
            document.getElementById('gameSetup').classList.add('hidden');
            document.getElementById('liveGame').classList.add('hidden');
            document.getElementById('scoreHistory').innerHTML = '';
            document.getElementById('petarollAlert').classList.add('hidden');
            
            // Clear input fields
            document.getElementById('player1Input').value = '';
            document.getElementById('player2Input').value = '';
            document.getElementById('customScore1').value = '';
            document.getElementById('customScore2').value = '';
            
            // Reset to game mode selection
            loadLiveSection();
        }

        // Teams section
        function loadTeams() {
            const teamsHtml = teams.map(team => {
                const teamGames = games.filter(g => g.winner === team.id || g.loser === team.id);
                const wins = games.filter(g => g.winner === team.id).reduce((sum, g) => sum + (g.gameValue || 1), 0);
                const losses = games.filter(g => g.loser === team.id).reduce((sum, g) => sum + (g.gameValue || 1), 0);
                const petarolls = games.filter(g => g.winner === team.id && g.isPetaroll).length;
                const gotPetarolled = games.filter(g => g.loser === team.id && g.isPetaroll).length;
                const totalGames = wins + losses;
                const winRate = totalGames > 0 ? ((wins / totalGames) * 100).toFixed(1) : 0;
                
                return `
                    <div class="domino-card p-6">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-xl font-bold">${team.player1} & ${team.player2}</h3>
                            <button onclick="deleteTeam('${team.id}')" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center">
                                <i class="fas fa-user mr-2 text-blue-500"></i>
                                <span>${team.player1}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-user mr-2 text-green-500"></i>
                                <span>${team.player2}</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div>
                                <div class="text-2xl font-bold text-green-600">${wins}</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">Wins</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-red-600">${losses}</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">Losses</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-blue-600">${winRate}%</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">Win Rate</div>
                            </div>
                        </div>
                        <div class="mt-3 text-center space-y-1">
                            ${petarolls > 0 ? `<span class="petaroll-badge">${petarolls} PETAROLLS DONE</span>` : ''}
                            ${gotPetarolled > 0 ? `<span class="petarolled-badge">GOT PETAROLLED ${gotPetarolled} TIMES</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('teamsList').innerHTML = teamsHtml || '<div class="col-span-full text-center text-gray-500 dark:text-gray-400">No teams created yet</div>';
        }

        function showCreateTeam() {
            document.getElementById('createTeamForm').classList.remove('hidden');
        }

        function hideCreateTeam() {
            document.getElementById('createTeamForm').classList.add('hidden');
            document.getElementById('player1Name').value = '';
            document.getElementById('player2Name').value = '';
        }

        function createTeam() {
            const player1Name = document.getElementById('player1Name').value.trim();
            const player2Name = document.getElementById('player2Name').value.trim();
            
            if (!player1Name || !player2Name) {
                alert('Please fill in both player names');
                return;
            }
            
            // Check for duplicate team
            const isDuplicate = teams.some(team => 
                (team.player1 === player1Name && team.player2 === player2Name) ||
                (team.player1 === player2Name && team.player2 === player1Name)
            );
            
            if (isDuplicate) {
                alert('This team already exists!');
                return;
            }
            
            const newTeam = {
                id: Date.now().toString(),
                player1: player1Name,
                player2: player2Name,
                created: new Date().toISOString()
            };
            
            teams.push(newTeam);
            localStorage.setItem('dominoTeams', JSON.stringify(teams));
            
            hideCreateTeam();
            loadTeams();
            populateTeamSelects();
        }

        function deleteTeam(teamId) {
            if (confirm('Are you sure you want to delete this team?')) {
                teams = teams.filter(t => t.id !== teamId);
                localStorage.setItem('dominoTeams', JSON.stringify(teams));
                loadTeams();
                populateTeamSelects();
            }
        }

        // Leaderboard section
        function loadLeaderboard() {
            // Update last updated time
            document.getElementById('lastUpdatedTime').textContent = new Date().toLocaleString();
            showLeaderboard('daily');
        }

        function showLeaderboard(period) {
            currentPeriod = period;
            
            // Update tab states
            document.querySelectorAll('.leaderboard-tab').forEach(tab => {
                tab.classList.remove('bg-blue-500', 'text-white');
                tab.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
            });

            document.querySelector(`[onclick="showLeaderboard('${period}')"]`).classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
            document.querySelector(`[onclick="showLeaderboard('${period}')"]`).classList.add('bg-blue-500', 'text-white');
            
            // Ensure we have the latest data
            games = JSON.parse(localStorage.getItem('dominoGames')) || [];
            
            loadTeamRankings(period);
            loadPlayerStats(period);
            loadPerformanceChart(period);
        }

        function getPeriodDateRange(period) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            switch (period) {
                case 'daily':
                    return `Today - ${today.toLocaleDateString()}`;
                case 'weekly':
                    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    return `${weekAgo.toLocaleDateString()} - ${today.toLocaleDateString()}`;
                case 'monthly':
                    const monthAgo = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
                    return `${monthAgo.toLocaleDateString()} - ${today.toLocaleDateString()}`;
                case 'alltime':
                default:
                    if (games.length > 0) {
                        const oldestGame = games.reduce((oldest, game) => 
                            new Date(game.date) < new Date(oldest.date) ? game : oldest
                        );
                        return `Since ${new Date(oldestGame.date).toLocaleDateString()}`;
                    }
                    return 'All Time';
            }
        }

        function loadTeamRankings(period) {
            const dateRange = getPeriodDateRange(period);
            document.getElementById('teamPeriodInfo').textContent = dateRange;
            
            const filteredGames = filterGamesByPeriod(games, period);
            const teamStats = {};
            
            teams.forEach(team => {
                teamStats[team.id] = {
                    name: `${team.player1} & ${team.player2}`,
                    wins: 0,
                    losses: 0,
                    petarolls: 0,
                    gotPetarolled: 0
                };
            });
            
            filteredGames.forEach(game => {
                if (game.gameMode !== 'single') {
                    if (teamStats[game.winner]) {
                        teamStats[game.winner].wins += game.gameValue || 1;
                        if (game.isPetaroll) teamStats[game.winner].petarolls++;
                    }
                    if (teamStats[game.loser]) {
                        teamStats[game.loser].losses += game.gameValue || 1;
                        if (game.isPetaroll) teamStats[game.loser].gotPetarolled++;
                    }
                }
            });
            
            const rankings = Object.values(teamStats)
                .filter(stat => stat.wins > 0 || stat.losses > 0)
                .sort((a, b) => {
                    const aTotal = a.wins + a.losses;
                    const bTotal = b.wins + b.losses;
                    const aWinRate = a.wins / aTotal;
                    const bWinRate = b.wins / bTotal;
                    if (aWinRate !== bWinRate) return bWinRate - aWinRate;
                    return b.wins - a.wins;
                });
            
            const rankingsHtml = rankings.map((stat, index) => {
                const total = stat.wins + stat.losses;
                const winRate = ((stat.wins / total) * 100).toFixed(1);
                const medal = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : `#${index + 1}`;
                
                return `
                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg mb-2">
                        <div class="flex items-center space-x-3">
                            <span class="text-xl">${medal}</span>
                            <div>
                                <div class="font-bold">${stat.name}</div>
                                <div>
                                    ${stat.petarolls > 0 ? `<span class="petaroll-badge">${stat.petarolls} PETAROLL${stat.petarolls > 1 ? 'S' : ''}</span>` : ''}
                                    ${stat.gotPetarolled > 0 ? `<span class="petarolled-badge">PETAROLLED ${stat.gotPetarolled}x</span>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold">${stat.wins}W - ${stat.losses}L</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">${winRate}% Win Rate</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('teamRankings').innerHTML = rankingsHtml || '<p class="text-gray-500 dark:text-gray-400">No games played in this period</p>';
        }

        function loadPlayerStats(period) {
            const dateRange = getPeriodDateRange(period);
            document.getElementById('playerPeriodInfo').textContent = dateRange;
            
            const filteredGames = filterGamesByPeriod(games, period);
            const playerStats = {};
            
            // Collect all unique players from teams
            teams.forEach(team => {
                if (!playerStats[team.player1]) {
                    playerStats[team.player1] = { name: team.player1, wins: 0, losses: 0, petarolls: 0, gotPetarolled: 0, teams: [] };
                }
                if (!playerStats[team.player2]) {
                    playerStats[team.player2] = { name: team.player2, wins: 0, losses: 0, petarolls: 0, gotPetarolled: 0, teams: [] };
                }
                playerStats[team.player1].teams.push(`${team.player1} & ${team.player2}`);
                playerStats[team.player2].teams.push(`${team.player1} & ${team.player2}`);
            });
            
            // Calculate wins/losses for each player
            filteredGames.forEach(game => {
                if (game.gameMode === 'single') {
                    // Handle single player games
                    if (!playerStats[game.winner]) {
                        playerStats[game.winner] = { name: game.winner, wins: 0, losses: 0, petarolls: 0, gotPetarolled: 0, teams: ['Solo'] };
                    }
                    if (!playerStats[game.loser]) {
                        playerStats[game.loser] = { name: game.loser, wins: 0, losses: 0, petarolls: 0, gotPetarolled: 0, teams: ['Solo'] };
                    }
                    
                    playerStats[game.winner].wins += game.gameValue || 1;
                    if (game.isPetaroll) playerStats[game.winner].petarolls++;
                    
                    playerStats[game.loser].losses += game.gameValue || 1;
                    if (game.isPetaroll) playerStats[game.loser].gotPetarolled++;
                } else {
                    // Handle team games
                    const winnerTeam = teams.find(t => t.id === game.winner);
                    const loserTeam = teams.find(t => t.id === game.loser);
                    
                    if (winnerTeam) {
                        if (playerStats[winnerTeam.player1]) {
                            playerStats[winnerTeam.player1].wins += game.gameValue || 1;
                            if (game.isPetaroll) playerStats[winnerTeam.player1].petarolls++;
                        }
                        if (playerStats[winnerTeam.player2]) {
                            playerStats[winnerTeam.player2].wins += game.gameValue || 1;
                            if (game.isPetaroll) playerStats[winnerTeam.player2].petarolls++;
                        }
                    }
                    
                    if (loserTeam) {
                        if (playerStats[loserTeam.player1]) {
                            playerStats[loserTeam.player1].losses += game.gameValue || 1;
                            if (game.isPetaroll) playerStats[loserTeam.player1].gotPetarolled++;
                        }
                        if (playerStats[loserTeam.player2]) {
                            playerStats[loserTeam.player2].losses += game.gameValue || 1;
                            if (game.isPetaroll) playerStats[loserTeam.player2].gotPetarolled++;
                        }
                    }
                }
            });
            
            const playerRankings = Object.values(playerStats)
                .filter(stat => stat.wins > 0 || stat.losses > 0)
                .sort((a, b) => {
                    const aTotal = a.wins + a.losses;
                    const bTotal = b.wins + b.losses;
                    const aWinRate = a.wins / aTotal;
                    const bWinRate = b.wins / bTotal;
                    if (aWinRate !== bWinRate) return bWinRate - aWinRate;
                    return b.wins - a.wins;
                });
            
            const playersHtml = playerRankings.slice(0, 10).map((stat, index) => {
                const total = stat.wins + stat.losses;
                const winRate = ((stat.wins / total) * 100).toFixed(1);
                const medal = index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : `#${index + 1}`;
                
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg mb-2">
                        <div class="flex items-center space-x-3">
                            <span class="text-lg">${medal}</span>
                            <div>
                                <div class="font-medium">${stat.name}</div>
                                <div>
                                    ${stat.petarolls > 0 ? `<span class="petaroll-badge">${stat.petarolls} PETAROLL${stat.petarolls > 1 ? 'S' : ''}</span>` : ''}
                                    ${stat.gotPetarolled > 0 ? `<span class="petarolled-badge">PETAROLLED ${stat.gotPetarolled}x</span>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="text-right text-sm">
                            <div class="font-bold">${stat.wins}W - ${stat.losses}L</div>
                            <div class="text-gray-500 dark:text-gray-400">${winRate}%</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('playerStats').innerHTML = playersHtml || '<p class="text-gray-500 dark:text-gray-400">No games played in this period</p>';
        }

        function loadPerformanceChart(period) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const filteredGames = filterGamesByPeriod(games, period);
            
            // Group games by date
            const gamesByDate = {};
            filteredGames.forEach(game => {
                const date = new Date(game.date).toDateString();
                if (!gamesByDate[date]) gamesByDate[date] = 0;
                gamesByDate[date] += game.gameValue || 1;
            });
            
            const dates = Object.keys(gamesByDate).sort();
            const counts = dates.map(date => gamesByDate[date]);
            
            // Destroy existing chart if it exists
            if (chartInstances.performanceChart) {
                chartInstances.performanceChart.destroy();
            }
            
            chartInstances.performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates.map(date => new Date(date).toLocaleDateString()),
                    datasets: [{
                        label: 'Game Points',
                        data: counts,
                        borderColor: 'rgba(59, 130, 246, 1)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Fixed timer functions
        function startTurnTimer() {
            // Stop any existing timer first
            stopTurnTimer();
            
            // Get the time limit from input
            let timeLimit = parseInt(document.getElementById('turnTimeInput').value);
            
            // Validate and set default if needed
            if (!timeLimit || timeLimit <= 0) {
                timeLimit = 60;
            }
            
            // Enforce maximum of 60 seconds
            timeLimit = Math.min(timeLimit, 60);
            
            // Set the remaining time
            remainingTime = timeLimit;
            
            // Update the display immediately
            updateTurnTimerDisplay();
            
            // Start the interval
            turnTimer = setInterval(() => {
                remainingTime--;
                updateTurnTimerDisplay();
                
                if (remainingTime <= 0) {
                    stopTurnTimer();
                    // Play a sound or show alert
                    playTimerEndSound();
                    alert("Time's up!");
                }
            }, 1000);
        }

        function stopTurnTimer() {
            if (turnTimer) {
                clearInterval(turnTimer);
                turnTimer = null;
            }
            remainingTime = 0;
            updateTurnTimerDisplay();
        }

        function updateTurnTimerDisplay() {
            const display = document.getElementById('turnTimerDisplay');
            if (display) {
                if (remainingTime > 0) {
                    // Format the time nicely
                    const minutes = Math.floor(remainingTime / 60);
                    const seconds = remainingTime % 60;
                    const timeString = minutes > 0 
                        ? `${minutes}:${seconds.toString().padStart(2, '0')}` 
                        : `${seconds}s`;
                    
                    display.textContent = timeString;
                    
                    // Add visual feedback based on remaining time
                    display.classList.remove('text-green-600', 'text-yellow-600', 'text-red-600');
                    if (remainingTime > 30) {
                        display.classList.add('text-green-600');
                    } else if (remainingTime > 10) {
                        display.classList.add('text-yellow-600');
                    } else {
                        display.classList.add('text-red-600');
                        // Add pulsing effect for last 10 seconds
                        if (remainingTime <= 10) {
                            display.classList.add('animate-pulse');
                        }
                    }
                } else {
                    display.textContent = '--';
                    display.classList.remove('text-green-600', 'text-yellow-600', 'text-red-600', 'animate-pulse');
                }
            }
        }

        // Optional: Add a function to play a sound when timer ends
        function playTimerEndSound() {
            // You can add an audio element to your HTML and play it here
            // For now, we'll just use the browser's default beep if available
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZURE');
                audio.play();
            } catch (e) {
                // Silently fail if audio doesn't work
            }
        }

        // Play a short ding when the game ends
        function playEndGameSound() {
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZURE');
                audio.play();
            } catch (e) {
                // Ignore errors
            }
        }

        // Trigger fireworks and announce PETAROLL
        function playPetarollEffects() {
            playEndGameSound();
            try {
                const utter = new SpeechSynthesisUtterance('PETAROLL PETAROLL');
                speechSynthesis.speak(utter);
            } catch (e) {
                // Ignore speech errors
            }
            showFireworks();
        }

        // Simple fireworks effect using canvas-confetti
        function showFireworks() {
            if (typeof confetti !== 'function') return;
            const duration = 2000;
            const end = Date.now() + duration;
            (function frame() {
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 }
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 }
                });
                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            })();
        }

        function filterGamesByPeriod(games, period) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            switch (period) {
                case 'daily':
                    return games.filter(game => new Date(game.date) >= today);
                case 'weekly':
                    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                    return games.filter(game => new Date(game.date) >= weekAgo);
                case 'monthly':
                    const monthAgo = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
                    return games.filter(game => new Date(game.date) >= monthAgo);
                case 'alltime':
                default:
                    return games;
            }
        }

        // Voice recognition setup
        let recognition;
        let pendingVoiceAction = null;
        function initVoice() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                console.warn('SpeechRecognition not supported');
                return;
            }
            recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.onresult = (e) => {
                const transcript = e.results[0][0].transcript;
                const output = document.getElementById('voiceOutput');
                if (output) output.textContent = transcript;
                parseVoiceCommand(transcript);
            };
            recognition.onend = () => {
                const btn = document.getElementById('micBtn');
                if (btn && btn.classList.contains('bg-green-600')) {
                    // Keep listening if the mic is still active
                    recognition.start();
                }
            };
        }

        function toggleMic(start) {
            if (!recognition) return;
            const btn = document.getElementById('micBtn');
            const begin = start !== undefined ? start : !btn.classList.contains('bg-green-600');
            if (begin) {
                recognition.start();
                btn.classList.remove('bg-purple-500');
                btn.classList.add('bg-green-600');
                btn.innerHTML = '<i class="fas fa-microphone mr-2"></i>Listening';
            } else {
                recognition.stop();
                btn.classList.remove('bg-green-600');
                btn.classList.add('bg-purple-500');
                btn.innerHTML = '<i class="fas fa-microphone mr-2"></i>Voice';
            }
        }

        function showVoiceConfirmation(message, action) {
            pendingVoiceAction = action;
            const output = document.getElementById('voiceOutput');
            if (!output) return;
            output.innerHTML = `
                ${message}
                <div class="mt-2">
                    <button id="confirmVoiceAction" class="bg-green-500 hover:bg-green-600 text-white py-1 px-3 rounded mr-2">Confirm</button>
                    <button id="cancelVoiceAction" class="bg-gray-500 hover:bg-gray-600 text-white py-1 px-3 rounded">Cancel</button>
                </div>`;
            document.getElementById('confirmVoiceAction').onclick = () => {
                if (pendingVoiceAction) pendingVoiceAction();
                pendingVoiceAction = null;
                output.textContent = '';
            };
            document.getElementById('cancelVoiceAction').onclick = () => {
                pendingVoiceAction = null;
                output.textContent = '';
            };
        }

        function parseNumberFromText(str) {
            const direct = parseInt(str, 10);
            if (!isNaN(direct)) return direct;

            const words = str.trim().split(/[\s-]+/);
            const map = {
                zero: 0, one: 1, two: 2, three: 3, four: 4, five: 5,
                six: 6, seven: 7, eight: 8, nine: 9, ten: 10,
                eleven: 11, twelve: 12, thirteen: 13, fourteen: 14,
                fifteen: 15, sixteen: 16, seventeen: 17, eighteen: 18,
                nineteen: 19, twenty: 20, thirty: 30, forty: 40,
                fifty: 50, sixty: 60, seventy: 70, eighty: 80,
                ninety: 90, hundred: 100
            };

            let total = 0;
            let current = 0;
            words.forEach(w => {
                if (w === 'hundred') {
                    current *= 100;
                } else if (map[w] !== undefined) {
                    current += map[w];
                }
            });
            total += current;
            return total;
        }

        function parseVoiceCommand(text) {
            text = text.toLowerCase();
            const beat = text.match(/(.+) beat (.+) ([a-z0-9-\s]+) to ([a-z0-9-\s]+)/);
            if (beat) {
                const score1 = parseNumberFromText(beat[3]);
                const score2 = parseNumberFromText(beat[4]);
                if (currentGame) {
                    currentGame.score1 = score1;
                    currentGame.score2 = score2;
                    updateGameDisplay();
                    if (score1 >= 150 || score2 >= 150) {
                        setTimeout(declareWinner, 500);
                    }
                }
                return;
            }
            let m;
            m = text.match(/team (?:1|one|a) add ([a-z0-9-\s]+)/);
            if (m) {
                const val = parseNumberFromText(m[1]);
                showVoiceConfirmation(`Add ${val} to Team 1?`, () => addScore(1, val));
                return;
            }
            m = text.match(/team (?:2|two|b) add ([a-z0-9-\s]+)/);
            if (m) {
                const val = parseNumberFromText(m[1]);
                showVoiceConfirmation(`Add ${val} to Team 2?`, () => addScore(2, val));
                return;
            }
            m = text.match(/blue ([a-z0-9-\s]+)/);
            if (m) {
                const val = parseNumberFromText(m[1]);
                showVoiceConfirmation(`Add ${val} to Blue?`, () => addScore(1, val));
                return;
            }
            m = text.match(/red ([a-z0-9-\s]+)/);
            if (m) {
                const val = parseNumberFromText(m[1]);
                showVoiceConfirmation(`Add ${val} to Red?`, () => addScore(2, val));
                return;
            }
            if (text.includes('undo team one') || text.includes('undo team 1') || text.includes('undo team a')) {
                showVoiceConfirmation('Undo last Team 1 score?', () => undoScore(1));
                return;
            }
            if (text.includes('undo team two') || text.includes('undo team 2') || text.includes('undo team b')) {
                showVoiceConfirmation('Undo last Team 2 score?', () => undoScore(2));
                return;
            }
            if (text.includes('end game')) { endGame(); return; }
            if (text.includes('reset game')) { resetGame(); return; }
            if (text.includes('dark mode')) { document.getElementById('themeToggle').click(); return; }
        }

        // Initialize app
        function initApp() {
            initTheme();
            initVoice();
            showSection('home');
        }

        // Start the app
        initApp();
    </script>
</body>
</html>

